<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ARR Interest Calculator API</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 2rem; line-height: 1.4; }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { margin-bottom: 0.25rem; }
    code { background: #f5f5f5; padding: 0.1rem 0.3rem; border-radius: 3px; }
    textarea { width: 100%; height: 200px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    pre { background: #0f172a; color: #e2e8f0; padding: 1rem; border-radius: 8px; overflow: auto; }
    button { padding: 0.6rem 1rem; border-radius: 6px; border: 1px solid #cbd5e1; background: white; cursor: pointer; }
    button:hover { background: #f8fafc; }
    .flex { display: flex; gap: 1rem; }
    .col { flex: 1; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ARR Interest Calculator</h1>
    <p>This deployment exposes a JSON API at <code>/api/calc</code>. Send a POST request with the input payload, including historical RFR rates.</p>

    <h2>Try it</h2>
    <div class="flex">
      <div class="col">
        <p>Request body</p>
        <textarea id="req">{
  "principal": 1000000,
  "start_date": "2024-01-01",
  "end_date": "2024-04-01",
  "pricing_option": "SONIA",
  "lookback": 5,
  "margin": 2.0,
  "cas": 0.1,
  "rates": [
    { "date": "2023-12-20", "rate": 5.12 },
    { "date": "2023-12-21", "rate": 5.12 },
    { "date": "2023-12-22", "rate": 5.12 },
    { "date": "2023-12-27", "rate": 5.12 },
    { "date": "2023-12-28", "rate": 5.12 },
    { "date": "2023-12-29", "rate": 5.12 },
    { "date": "2024-01-02", "rate": 5.12 }
  ],
  "return_daily_details": false
}</textarea>
        <p><button id="send">POST /api/calc</button></p>
      </div>
      <div class="col">
        <p>Response</p>
        <pre id="res"></pre>
      </div>
    </div>
  </div>
  <script>
    document.getElementById('send').addEventListener('click', async () => {
      const resEl = document.getElementById('res');
      resEl.textContent = 'Loading...';
      try {
        const payload = JSON.parse(document.getElementById('req').value);
        const resp = await fetch('/api/calc', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
        const text = await resp.text();
        resEl.textContent = text;
      } catch (e) {
        resEl.textContent = e.message || String(e);
      }
    });
  </script>
</body>
</html>
